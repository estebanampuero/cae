<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Reservas</title>
    
    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- SheetJS (xlsx) CDN para leer archivos Excel -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* gray-50 */
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .day-selected {
            background-color: #4f46e5 !important; /* indigo-600 */
            color: white !important;
            font-weight: bold;
        }
        .slot-selected {
            background-color: #818cf8; /* indigo-400 */
            color: white;
            transform: scale(1.05);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        /* ===== INICIO DE CAMBIOS DE ESTILO ===== */
        .slot-occupied-wrapper {
            background-color: #e2e8f0; /* slate-200 */
            color: #475569; /* slate-600 */
            padding: 0.5rem;
            border-radius: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
            line-height: 1.25rem;
            min-height: 40px; /* Para alinear con los botones de horarios libres */
        }
        .delete-btn {
            background: #fecaca; /* red-200 */
            color: #b91c1c; /* red-700 */
            border-radius: 9999px;
            width: 1.75rem;
            height: 1.75rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0; /* Evita que el botón se encoja */
            margin-left: 0.5rem;
        }
        .delete-btn:hover {
            background: #ef4444; /* red-500 */
            color: white;
            transform: scale(1.1);
        }
        .slot-occupied { /* Se mantiene por si acaso, pero no es el principal */
            background-color: #e2e8f0; /* slate-200 */
            color: #94a3b8; /* slate-400 */
            cursor: not-allowed;
            text-decoration: line-through;
        }
        #time-slots-wrapper {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            padding-bottom: 1rem;
            scrollbar-width: thin;
            scrollbar-color: #cbd5e1 #f1f5f9;
        }
        @media (min-width: 640px) {
            #time-slots-wrapper {
                gap: 1.5rem;
            }
        }
        .box-column {
            flex: 0 0 160px; /* Ancho aumentado para dar espacio */
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        /* ===== FIN DE CAMBIOS DE ESTILO ===== */
        .box-title {
            font-weight: 600;
            color: #334155;
            text-align: center;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 0.5rem;
        }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="antialiased text-slate-700">

    <a href="https://lockedinwork.com" target="_blank" rel="noopener noreferrer" class="fixed top-4 right-4 z-[60] text-lg font-bold text-slate-800 opacity-40 hover:opacity-100 transition-opacity duration-300">
        LockedIn<span class="text-indigo-600">Work</span>
    </a>

    <div id="login-overlay" class="fixed inset-0 bg-slate-100 z-50 flex items-center justify-center p-4">
        <div class="w-full max-w-sm bg-white p-8 rounded-xl shadow-2xl fade-in">
            <h2 class="text-2xl font-bold text-slate-800 text-center mb-2">Acceso Restringido</h2>
            <p class="text-center text-slate-500 mb-6">Ingresa tus credenciales para continuar.</p>
            <form id="login-form">
                <div class="mb-4"><label for="username" class="block text-sm font-medium text-slate-600 mb-1">Usuario</label><input type="text" id="username" name="username" required class="w-full p-2 border border-slate-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"></div>
                <div class="mb-6"><label for="password" class="block text-sm font-medium text-slate-600 mb-1">Contraseña</label><input type="password" id="password" name="password" required class="w-full p-2 border border-slate-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"></div>
                <button type="submit" class="w-full bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-indigo-700 transition-all transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-indigo-300">Ingresar</button>
                <p id="login-error" class="text-red-500 text-sm text-center mt-4 hidden">Usuario o contraseña incorrectos.</p>
            </form>
        </div>
    </div>

    <div id="main-content" style="display: none;" class="container mx-auto p-4 md:p-6 lg:p-8 max-w-7xl pb-24 sm:pb-8">
        
        <header class="mb-8"><h1 class="text-2xl sm:text-3xl font-bold text-slate-800">Agendar y Gestionar Horas</h1><p class="text-slate-500 mt-1">Selecciona, reserva o elimina bloques horarios.</p></header>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8 p-4 sm:p-6 bg-white rounded-lg shadow-md">
            <div><label for="cae-select" class="block text-sm font-medium text-slate-600 mb-1">CAE</label><select id="cae-select" class="w-full p-2 border border-slate-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"><option value="">Cargando...</option></select></div>
            <div><label for="box-select" class="block text-sm font-medium text-slate-600 mb-1">BOX (Filtro)</label><select id="box-select" class="w-full p-2 border border-slate-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" disabled><option value="">Selecciona un CAE</option></select></div>
            <div><label for="medico-select" class="block text-sm font-medium text-slate-600 mb-1">MÉDICO</label><select id="medico-select" class="w-full p-2 border border-slate-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" disabled><option value="">Cargando...</option></select><input type="text" id="otro-medico-input" placeholder="Nombre del nuevo médico" class="w-full p-2 border border-slate-300 rounded-lg mt-2 shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition hidden"></div>
        </div>
        
        <div class="grid grid-cols-1 xl:grid-cols-5 gap-8">
            <div class="xl:col-span-2 bg-white p-4 sm:p-6 rounded-lg shadow-md">
                <div id="calendar-header" class="flex items-center justify-between mb-4"><button id="prev-month" class="p-2 rounded-full hover:bg-slate-100 transition"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg></button><h2 id="month-year" class="text-lg sm:text-xl font-semibold text-slate-800"></h2><button id="next-month" class="p-2 rounded-full hover:bg-slate-100 transition"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg></button></div>
                <div id="calendar-grid" class="grid grid-cols-7 gap-1 text-center"></div>
            </div>
            <div class="xl:col-span-3 bg-white p-4 sm:p-6 rounded-lg shadow-md fade-in" id="time-slots-container-wrapper"><h3 class="text-lg sm:text-xl font-semibold text-slate-800 mb-1">Horarios Disponibles</h3><p id="selected-day-text" class="text-slate-500 mb-4 text-sm sm:text-base">Selecciona un CAE y un día en el calendario</p><div id="time-slots-wrapper" class="max-h-96 pr-2"></div></div>
        </div>
        
        <button id="reservar-btn" class="fixed bottom-4 left-4 right-4 sm:left-auto sm:bottom-8 sm:right-8 sm:w-auto z-40 bg-indigo-600 text-white font-bold py-3 px-6 rounded-full shadow-lg hover:bg-indigo-700 transition-all transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-indigo-300 text-center">Reservar</button>
        <div id="toast" class="fixed top-4 right-4 left-4 sm:left-auto sm:w-auto z-50 p-4 rounded-lg shadow-xl text-white transition-transform transform translate-x-full sm:translate-x-[120%]" role="alert"><span id="toast-message"></span></div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        const USERS = {"admin":"clave123","usuario1":"pass456"};
        const loginOverlay=document.getElementById("login-overlay"),mainContent=document.getElementById("main-content"),loginForm=document.getElementById("login-form");
        loginForm.addEventListener("submit",e=>{e.preventDefault();const t=document.getElementById("username").value,o=document.getElementById("password").value;USERS[t]&&USERS[t]===o?(loginOverlay.style.display="none",mainContent.style.display="block",init()):document.getElementById("login-error").classList.remove("hidden")});
        
        const SHEET_ID="1f3BMghdIXySvO7IVb0V2xXnYb1mXta4feq-MZQ-iNF0",GID_CONFIG="0",GID_MEDICOS="1913556286",URL_CONFIG=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=xlsx&gid=${GID_CONFIG}`,URL_MEDICOS=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=xlsx&gid=${GID_MEDICOS}`,API_RESERVAS_URL="https://agentes-liw-n8n-test.6tpykr.easypanel.host/webhook/a3398cd3-14aa-4a54-9c64-abecb95d88e8",API_CHECK_URL="https://agentes-liw-n8n-test.6tpykr.easypanel.host/webhook/2ef1ad96-a7b2-4669-8a8f-d1874781f147";
        const domRefs={caeSelect:document.getElementById("cae-select"),boxSelect:document.getElementById("box-select"),medicoSelect:document.getElementById("medico-select"),otroMedicoInput:document.getElementById("otro-medico-input"),calendarGrid:document.getElementById("calendar-grid"),monthYearEl:document.getElementById("month-year"),prevMonthBtn:document.getElementById("prev-month"),nextMonthBtn:document.getElementById("next-month"),timeSlotsWrapper:document.getElementById("time-slots-wrapper"),selectedDayText:document.getElementById("selected-day-text"),timeSlotsContainer:document.getElementById("time-slots-container-wrapper"),reservarBtn:document.getElementById("reservar-btn"),toastEl:document.getElementById("toast"),toastMessageEl:document.getElementById("toast-message")};
        let configData=[],medicosList=[],currentDate=new Date,selectedDate=null,selectedTimeSlots=new Set,selectedBoxForReservation=null,allOccupiedSlots=new Map;
        const init=async()=>{domRefs.timeSlotsContainer.style.display="none",await loadAndPopulateFilters(),renderCalendar(),setupEventListeners()};

        const fetchSheetData=async(e,t)=>{try{const o=await fetch(e);if(!o.ok)throw new Error("Error al descargar datos.");const n=await o.arrayBuffer(),s=XLSX.read(new Uint8Array(n),{type:"array"}),r=s.Sheets[s.SheetNames[0]],a=XLSX.utils.sheet_to_json(r);if(a.length>0)for(const c of t)if(!(c in a[0]))throw new Error(`La columna "${c}" no se encontró.`);return a}catch(i){throw i}};
        const loadAndPopulateFilters=async()=>{try{[configData,medicosList]=await Promise.all([fetchSheetData(URL_CONFIG,["cae","box","calendar_id"]),fetchSheetData(URL_MEDICOS,["medico"])]),populateCaeSelect(),populateMedicoSelect(),showToast("Datos cargados.","success")}catch(e){showToast(e.message,"error")}};
        
        // ===== INICIO DE CAMBIOS DE LÓGICA =====
        
        const fetchAllBoxAvailabilities=async()=>{const e=domRefs.caeSelect.value;if(allOccupiedSlots.clear(),!e||!selectedDate)return renderAllTimeSlots();const t=configData.filter(t=>String(t.cae).trim()===e.trim()&&t.calendar_id);if(0===t.length)return renderAllTimeSlots();domRefs.timeSlotsWrapper.innerHTML='<p class="w-full text-center text-slate-500 animate-pulse">Consultando disponibilidad...</p>';const o=new Date(selectedDate);o.setHours(0,0,0,0);const n=new Date(selectedDate);n.setHours(23,59,59,999);const s=t.map(async e=>{try{const t=await fetch(API_CHECK_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({calendar_id:e.calendar_id,timeMin:o.toISOString(),timeMax:n.toISOString()})});if(!t.ok)return{box:e.box,occupied:[]};const s=await t.json();return{box:e.box,occupied:s.occupied||[]}}catch(r){return{box:e.box,occupied:[]}}});try{const r=await Promise.all(s);r.forEach(e=>{const t=e.occupied.reduce((e,t)=>(e[t.time]={eventId:t.eventId,summary:t.summary},e),{});allOccupiedSlots.set(e.box,t)})}catch(a){showToast("Error al consultar la disponibilidad.","error")}finally{renderAllTimeSlots()}};
        
        const renderAllTimeSlots=()=>{if(domRefs.timeSlotsContainer.style.display="block",domRefs.timeSlotsWrapper.innerHTML="",!selectedDate)return domRefs.selectedDayText.textContent="Selecciona un CAE y un día en el calendario";domRefs.selectedDayText.textContent=`Día: ${selectedDate.toLocaleString("es-ES",{weekday:"long",day:"numeric",month:"long"})}`;const e=domRefs.caeSelect.value,t=[...new Set(configData.filter(t=>String(t.cae).trim()===e.trim()).map(e=>e.box))].sort((e,t)=>String(e).localeCompare(String(t),void 0,{numeric:!0}));if(0===t.length)return domRefs.timeSlotsWrapper.innerHTML='<p class="w-full text-center text-slate-500">No hay boxes configurados.</p>';t.forEach(e=>{const t=document.createElement("div");t.className="box-column",t.dataset.boxColumn=e,t.innerHTML=`<h4 class="box-title">${e}</h4>`;const o=allOccupiedSlots.get(e)||{},n=configData.find(t=>String(t.box).trim()===e.trim()&&String(t.cae).trim()===domRefs.caeSelect.value)?.calendar_id;for(let s=8;s<20;s++)for(let r=0;r<60;r+=30){const a=`${String(s).padStart(2,"0")}:${String(r).padStart(2,"0")}`,c=o[a];if(c&&c.eventId){const i=document.createElement("div");i.className="slot-occupied-wrapper",i.innerHTML=`<span class="truncate" title="${c.summary||"Ocupado"}">${c.summary||"Ocupado"}</span><button class="delete-btn" title="Eliminar reserva" data-event-id="${c.eventId}" data-calendar-id="${n}">&times;</button>`,t.appendChild(i)}else{const l=document.createElement("button");l.textContent=a,l.dataset.time=a,l.dataset.box=e,l.className="p-2 rounded-lg transition-all text-sm bg-slate-100 hover:bg-indigo-200",selectedBoxForReservation===e&&selectedTimeSlots.has(a)&&l.classList.add("slot-selected"),t.appendChild(l)}}domRefs.timeSlotsWrapper.appendChild(t)}),filterBoxView()};
        
        const handleDeleteClick=async e=>{const t=e.target.closest(".delete-btn");if(!t)return;if(!confirm("¿Estás seguro de que quieres eliminar esta reserva?"))return;const o=t.dataset.eventId,n=t.dataset.calendarId;showToast("Eliminando reserva...","info"),t.disabled=!0;try{const s=await fetch(API_RESERVAS_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"delete",event_id:o,calendar_id:n})});if(!s.ok)throw new Error(`El servidor respondió con ${s.status}`);showToast("Reserva eliminada con éxito.","success"),await fetchAllBoxAvailabilities()}catch(r){showToast("Error al eliminar la reserva.","error"),t.disabled=!1}};
        
        const setupEventListeners=()=>{domRefs.caeSelect.addEventListener("change",()=>{updateBoxSelect(),selectedDate?fetchAllBoxAvailabilities():(domRefs.timeSlotsContainer.style.display="none",selectedTimeSlots.clear(),selectedBoxForReservation=null)}),domRefs.boxSelect.addEventListener("change",filterBoxView),domRefs.medicoSelect.addEventListener("change",()=>{domRefs.otroMedicoInput.classList.toggle("hidden","otro"!==domRefs.medicoSelect.value)});const e=e=>{currentDate.setMonth(currentDate.getMonth()+e),renderCalendar(),domRefs.timeSlotsContainer.style.display="none",selectedDate=null};domRefs.prevMonthBtn.addEventListener("click",()=>e(-1)),domRefs.nextMonthBtn.addEventListener("click",()=>e(1)),domRefs.calendarGrid.addEventListener("click",async e=>{const t=e.target.closest("button");if(!t||!t.dataset.date)return;if(!domRefs.caeSelect.value)return showToast("Primero debes seleccionar un CAE.","info");document.querySelectorAll("#calendar-grid button.day-selected").forEach(e=>e.classList.remove("day-selected")),t.classList.add("day-selected"),selectedDate=new Date(t.dataset.date),await fetchAllBoxAvailabilities()}),domRefs.timeSlotsWrapper.addEventListener("click",e=>{e.target.closest(".delete-btn")?handleDeleteClick(e):e.target.closest("button[data-time]")&&handleTimeSlotClick(e)}),domRefs.reservarBtn.addEventListener("click",handleReserveClick)};
        
        // ===== FIN DE CAMBIOS DE LÓGICA =====
        
        const populateCaeSelect=()=>{const e=[...new Set(configData.map(item=>item.cae))];domRefs.caeSelect.innerHTML='<option value="">Selecciona un CAE</option>',e.sort().forEach(cae=>{const t=document.createElement("option");t.value=cae,t.textContent=cae,domRefs.caeSelect.appendChild(t)})};
        const updateBoxSelect=()=>{const e=domRefs.caeSelect.value;domRefs.boxSelect.innerHTML='<option value="">Selecciona un CAE</option>',domRefs.boxSelect.disabled=!0,e&&(uniqueBoxes=[...new Set(configData.filter(item=>String(item.cae).trim()===e.trim()).map(item=>item.box).sort((a,b)=>String(a).localeCompare(String(b),void 0,{numeric:!0})))],domRefs.boxSelect.innerHTML='<option value="all">-- Todos los BOX --</option>',uniqueBoxes.forEach(box=>{const t=document.createElement("option");t.value=box,t.textContent=box,domRefs.boxSelect.appendChild(t)}),domRefs.boxSelect.disabled=!1)};
        const filterBoxView=()=>{const e=domRefs.boxSelect.value;document.querySelectorAll(".box-column").forEach(t=>{"all"===e||""===e?t.style.display="flex":t.style.display=t.dataset.boxColumn===e?"flex":"none"})};
        const handleTimeSlotClick=e=>{const t=e.target.closest("button");if(!t||!t.dataset.time||t.disabled)return;const o=t.dataset.time,n=t.dataset.box;selectedBoxForReservation&&selectedBoxForReservation!==n&&(selectedTimeSlots.clear(),document.querySelectorAll(".slot-selected").forEach(el=>el.classList.remove("slot-selected"))),selectedBoxForReservation=n,selectedTimeSlots.has(o)?(selectedTimeSlots.delete(o),t.classList.remove("slot-selected")):(selectedTimeSlots.add(o),t.classList.add("slot-selected")),0===selectedTimeSlots.size&&(selectedBoxForReservation=null)};
        const formatToISOWithOffset=(e,t)=>{const[o,n]=t.split(":"),s=new Date(e);s.setHours(o,n,0,0);const r=s.getFullYear(),a=String(s.getMonth()+1).padStart(2,"0"),c=String(s.getDate()).padStart(2,"0"),i=(e=>{const t=e.getFullYear(),o=new Date(t,8,1),n=new Date(o);n.setDate(1+(6-o.getDay()+7)%7),n.setHours(23,59,59);const s=new Date(t,3,1),r=new Date(s);return r.setDate(1+(6-s.getDay()+7)%7),r.setHours(23,59,59),e>=n||e<r?"-03:00":"-04:00"})(s);return`${r}-${a}-${c}T${t}:00${i}`};
        async function handleReserveClick(){const e=domRefs.caeSelect.value,t=selectedBoxForReservation;let o=domRefs.medicoSelect.value;const n=domRefs.otroMedicoInput.value.trim();if("otro"===o){if(!n)return showToast("Por favor, ingresa el nombre del nuevo médico.","error");o=n}if(!e||!t||!o||!selectedDate||0===selectedTimeSlots.size)return showToast("Completa todos los filtros (CAE, Médico) y selecciona un horario en un BOX.","error");const s=configData.find(item=>String(item.cae).trim()===e.trim()&&String(item.box).trim()===t.trim());if(!s)return showToast("Error: No se encontró calendario para esa combinación de CAE y BOX.","error");await fetchAllBoxAvailabilities();const r=Array.from(selectedTimeSlots),a=allOccupiedSlots.get(t)||{};if(r.some(slot=>a[slot]))return showToast("¡Conflicto! Uno de los horarios fue ocupado mientras elegías. Por favor, selecciona otros.","error"),selectedTimeSlots.clear(),selectedBoxForReservation=null,renderAllTimeSlots(),void 0;const c=s.calendar_id,i=r.sort().map(time=>{const[e,t]=time.split(":").map(Number),o=new Date(selectedDate);o.setHours(e,t,0,0);const n=new Date(o);n.setMinutes(o.getMinutes()+30);return{fecha_inicio:formatToISOWithOffset(selectedDate,time),fecha_fin:formatToISOWithOffset(selectedDate,`${String(n.getHours()).padStart(2,"0")}:${String(n.getMinutes()).padStart(2,"0")}`)}}),l={cae:e,box:t,medico:o,nuevo_medico:"otro"===domRefs.medicoSelect.value,calendar_id:c,reservas:i};domRefs.reservarBtn.disabled=!0,domRefs.reservarBtn.textContent="Reservando...",showToast("Enviando reserva...","info");try{const d=await fetch(API_RESERVAS_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!d.ok)throw new Error(`El servidor respondió con ${d.status}`);showToast("¡Reserva realizada con éxito!","success"),resetForm()}catch(u){console.error("Error al enviar la reserva:",u),showToast("Error al enviar la reserva. Intenta de nuevo.","error")}finally{domRefs.reservarBtn.disabled=!1,domRefs.reservarBtn.textContent="Reservar"}}
        const showToast=(e,t="info")=>{domRefs.toastMessageEl.textContent=e;const o=window.innerWidth<640,n=o?"translateX(100%)":"translateX(120%)";domRefs.toastEl.classList.remove("bg-green-500","bg-red-500","bg-blue-500"),o?(domRefs.toastEl.classList.remove("translate-x-[120%]"),domRefs.toastEl.classList.add("translate-x-full")):(domRefs.toastEl.classList.remove("translate-x-full"),domRefs.toastEl.classList.add("translate-x-[120%]"));const s={success:"bg-green-500",error:"bg-red-500",info:"bg-blue-500"};domRefs.toastEl.classList.add(s[t]),domRefs.toastEl.style.transform="translateX(0)",setTimeout(()=>{domRefs.toastEl.style.transform=n},4e3)};
        const resetForm=()=>{domRefs.caeSelect.value="",updateBoxSelect(),domRefs.medicoSelect.value="",domRefs.otroMedicoInput.value="",domRefs.otroMedicoInput.classList.add("hidden"),selectedDate=null,selectedTimeSlots.clear(),selectedBoxForReservation=null,allOccupiedSlots.clear(),domRefs.timeSlotsContainer.style.display="none",document.querySelectorAll("#calendar-grid button.day-selected").forEach(e=>e.classList.remove("day-selected"))};
        function populateMedicoSelect(){domRefs.medicoSelect.innerHTML='<option value="">Selecciona un Médico</option>',medicosList.forEach(item=>{const e=document.createElement("option");e.value=item.medico,e.textContent=item.medico,domRefs.medicoSelect.appendChild(e)});const e=document.createElement("option");e.value="otro",e.textContent="Otro / Agregar médico...",domRefs.medicoSelect.appendChild(e),domRefs.medicoSelect.disabled=!1}
        function renderCalendar(){domRefs.calendarGrid.innerHTML='<div class="font-medium text-xs text-slate-500">LU</div><div class="font-medium text-xs text-slate-500">MA</div><div class="font-medium text-xs text-slate-500">MI</div><div class="font-medium text-xs text-slate-500">JU</div><div class="font-medium text-xs text-slate-500">VI</div><div class="font-medium text-xs text-slate-500">SA</div><div class="font-medium text-xs text-slate-500">DO</div>';const e=currentDate.getFullYear(),t=currentDate.getMonth();domRefs.monthYearEl.textContent=currentDate.toLocaleString("es-ES",{month:"long",year:"numeric"}).replace(/^\w/,e=>e.toUpperCase());const o=new Date(e,t,1),n=new Date(e,t+1,0).getDate(),s=(o.getDay()+6)%7;for(let r=0;r<s;r++)domRefs.calendarGrid.appendChild(document.createElement("div"));for(let a=1;a<=n;a++){const c=document.createElement("button");c.textContent=a,c.classList.add("p-1","sm:p-2","rounded-full","hover:bg-slate-100","transition","cursor-pointer","w-full","aspect-square","flex","items-center","justify-center","mx-auto","text-sm");const i=new Date;e===i.getFullYear()&&t===i.getMonth()&&a===i.getDate()&&c.classList.add("bg-slate-200","font-bold"),c.dataset.date=new Date(e,t,a).toISOString(),domRefs.calendarGrid.appendChild(c)}};
    });
    </script>
</body>
</html>
